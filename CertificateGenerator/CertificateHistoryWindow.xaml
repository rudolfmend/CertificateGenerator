<?xml version="1.0" encoding="utf-8"?>
<Window x:Class="CertificateGenerator.CertificateHistoryWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="História certifikátov" 
        Height="800" 
        Width="1200"
        MinHeight="580" 
        MinWidth="700"
        FontSize="14"
        WindowStartupLocation="CenterScreen"
        WindowState="Maximized"
        ResizeMode="CanResize"
        Background="{StaticResource BackgroundColor}">

    <Grid Margin="25,10,25,0">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" 
                Style="{StaticResource Card}" 
                Margin="0,0,0,15">
            <StackPanel>
                <TextBlock Text="História vygenerovaných certifikátov" 
                           FontSize="20"
                           FontWeight="Bold"
                           Foreground="{StaticResource TextPrimaryColor}"
                           HorizontalAlignment="Center"
                           Margin="0,0,0,5"/>
                <TextBlock Text="Prehľad všetkých vytvorených certifikátov a štatistiky" 
                           FontSize="13"
                           Foreground="{StaticResource TextSecondaryColor}"
                           HorizontalAlignment="Center"/>
            </StackPanel>
        </Border>

        <!-- Filters -->
        <Border Grid.Row="1" 
                Style="{StaticResource Card}" 
                Margin="0,0,0,15">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="2*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Search -->
                <StackPanel Grid.Column="0" Margin="0,0,15,0">
                    <Label Content="🔍 Vyhľadávanie:" Style="{StaticResource ModernLabel}"/>
                    <TextBox x:Name="TxtSearch" 
                             Style="{StaticResource ModernTextBox}"
                             TextChanged="TxtSearch_TextChanged"
                             ToolTip="Hľadať podľa mena, organizátora alebo témy"/>
                </StackPanel>

                <!-- Date From -->
                <StackPanel Grid.Column="1" Margin="0,0,15,0">
                    <Label Content="Od dátumu:" Style="{StaticResource ModernLabel}"/>
                    <DatePicker x:Name="DtpDateFrom" 
                                Style="{StaticResource ModernDatePicker}"
                                SelectedDateChanged="DateFilter_Changed"/>
                </StackPanel>

                <!-- Date To -->
                <StackPanel Grid.Column="2" Margin="0,0,15,0">
                    <Label Content="Do dátumu:" Style="{StaticResource ModernLabel}"/>
                    <DatePicker x:Name="DtpDateTo" 
                                Style="{StaticResource ModernDatePicker}"
                                SelectedDateChanged="DateFilter_Changed"/>
                </StackPanel>

                <!-- Clear Filters -->
                <Button Grid.Column="3"
                        Content="🔄 Zrušiť filtre"
                        Style="{StaticResource SecondaryButton}"
                        VerticalAlignment="Bottom"
                        Click="ClearFilters_Click"/>
            </Grid>
        </Border>

        <!-- DataGrid -->
        <Border Grid.Row="2" 
                Style="{StaticResource Card}" 
                Margin="0,0,0,20">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <Label Grid.Row="0"
                       Content="Zoznam certifikátov"
                       Style="{StaticResource ModernLabel}"
                       FontSize="16"
                       FontWeight="Bold"
                       Margin="0,0,0,15"/>

                <Border Grid.Row="1"
                        BorderThickness="1"
                        BorderBrush="{StaticResource BorderColor}"
                        CornerRadius="6"
                        Background="{StaticResource SurfaceColor}">
                    <DataGrid x:Name="DgCertificates"
                              Style="{StaticResource ModernDataGrid}"
                              BorderThickness="0"
                              MouseDoubleClick="DgCertificates_MouseDoubleClick">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Účastník" 
                                                Binding="{Binding ParticipantName}" 
                                                Width="*"
                                                MinWidth="180"/>
                            <DataGridTextColumn Header="Organizátor" 
                                                Binding="{Binding OrganizerName}" 
                                                Width="*"
                                                MinWidth="150"/>
                            <DataGridTextColumn Header="Téma" 
                                                Binding="{Binding EventTopicName}" 
                                                Width="2*"
                                                MinWidth="200"/>
                            <DataGridTextColumn Header="Dátum podujatia" 
                                                Binding="{Binding EventDate, StringFormat=dd.MM.yyyy}" 
                                                Width="130"/>
                            <DataGridTextColumn Header="Vytvorené" 
                                                Binding="{Binding CreatedAt, StringFormat=dd.MM.yyyy HH:mm}" 
                                                Width="150"/>
                            <DataGridTextColumn Header="Formát" 
                                                Binding="{Binding PaperFormat}" 
                                                Width="80"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </Border>
            </Grid>
        </Border>

        <!-- Footer with Statistics and Actions -->
        <Grid Grid.Row="3">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>


            <Separator  Grid.Row="2" VerticalAlignment="Top" HorizontalContentAlignment="Stretch" Background="Gray" Margin="-29,0,-660,10" />


            <!-- Buttons -->
            <Border Grid.Row="2" Padding="25,15,25,0" Background="Blue" Margin="-30,-10,-700,15" >
                <!-- Statistics -->
                <Border Grid.Column="0"
                        Background="{StaticResource InputBackground}"
                        CornerRadius="8"
                        Padding="20,12"
                        Margin="0,0,15,0">
                    <StackPanel Orientation="Horizontal" >
                        <TextBlock Text="📊 Celkom certifikátov: " 
                                   FontWeight="SemiBold"
                                   FontSize="14"/>
                        <TextBlock x:Name="TxtTotalCount" 
                                   Text="0" 
                                   Foreground="{StaticResource PrimaryColor}" 
                                   FontWeight="Bold"
                                   FontSize="14"/>
                        <TextBlock Text=" | Zobrazených: " 
                                   Margin="20,0,0,0"
                                   FontWeight="SemiBold"
                                   FontSize="14"/>
                        <TextBlock x:Name="TxtFilteredCount" 
                                   Text="0" 
                                   Foreground="{StaticResource SuccessColor}" 
                                   FontWeight="Bold"
                                   FontSize="14"/>
                    </StackPanel>
                </Border>

            </Border>
                <!-- Action Buttons -->
            <StackPanel Grid.Column="1" 
                        Orientation="Horizontal">
                <Button Content="📂 Otvoriť súbor" 
                        Style="{StaticResource ModernButton}"
                        Margin="0,0,8,0"
                        Click="OpenFile_Click"/>
                <Button Content="📁 Otvoriť priečinok" 
                        Style="{StaticResource ModernButton}"
                        Margin="0,0,8,0"
                        Click="OpenFolder_Click"/>
                <Button Content="🗑️ Odstrániť záznam" 
                        Style="{StaticResource DangerButton}"
                        Margin="0,0,8,0"
                        Click="DeleteRecord_Click"/>
                <Button Content="✖️ Zavrieť" 
                        IsCancel="True"
                        Style="{StaticResource SecondaryButton}"
                        Click="Close_Click"/>
            </StackPanel>
        </Grid>
    </Grid>
</Window>
